{% extends 'base.html' %}

{% block body %}
	<div id="campaign" class="row">
		<div class="col-4">
			<div>
				<img src="static/campaign.png">
			</div>
			<p>Explore our seasonal deals with great deals</p>
			<div className="text-center">
				<a href="./shop/campaign"><button class="btn btn-outline-dark">SHOP NOW!</button></a>
			</div>
		</div>
	</div>
	{% if sections %}
		{% for s in sections %}
			{% if s.products %}
			<div class="row">
				<div class="col">
					<div class="row" data-toggle="collapse" data-target="#multiCollapseExample-{{ s.id }}">
						<div class="col bg-dark colmar text-center">
							<h3 class="productheader"><strong class="title">⭐️{{s.name}}</strong></h3>
							<span class="text-right"><i class="fas fa-caret-square-down fa-2x productdropdown"></i></span>
						</div>
					</div>
					<div class="row mb-1 flex show" id="multiCollapseExample-{{ s.id }}">
						{% for p in s.products %}
							<div class="col">
								<div class="text-center">
									<a href="./{{p.product_type}}/{{p.id}}">
										<img src="{{p.image_link}}">
									</a>
									<h4>{{ p.name }}</h4>
								</div>

								<div class="row">
									<div class="col d-flex align-items-center">
										<h5>{{p.price}}</h5>
									</div>
									<div class="col text-right">
										<button class="btn btn-outline-dark" onclick="addToCart(this)">Add to cart</button>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
				</div>
			</div>
			{% endif %}
		{% endfor %}
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Information</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						...
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
					</div>
				</div>
			</div>
		</div>
		<script>
			function cookieExists(cookie) {
				return document.cookie.indexOf(`${cookie}=`) != -1
			}

			function getCookie(cname) {
				var name = cname + "=";
				var decodedCookie = decodeURIComponent(document.cookie);
				var ca = decodedCookie.split(';');
				for(var i = 0; i <ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) == ' ') {
						c = c.substring(1);
					}
					if (c.indexOf(name) == 0) {
					return c.substring(name.length, c.length);
					}
				}
				return "";
			}

			function addToCart(clicked) {
				let p = $(clicked).parent().parent().siblings()[0];
				let text = $($(p).children()[1]).text();
				let price = $($($(clicked).parent().parent().children()[0]).children()[0]).text();

				$('#exampleModal').modal('toggle');
				$("#exampleModal .modal-body").empty();
				$("#exampleModal .modal-body").append(`<div class="alert alert-success" role="alert">Added ${text} to shopping cart!</div>`);

				if(!cookieExists("cart")) {
					document.cookie = `cart=[]`;
				}

				let cart = JSON.parse(getCookie("cart"));
				cart.push({id: 0, name: text, price: price}); //Potentially remove information in cookies in the future as it is a security flaw and could be exploited. Alternatively use cookie verification like JWT.
				document.cookie = `cart=${JSON.stringify(cart)}`;

			}
		</script>
	{% endif %}
{% endblock %}